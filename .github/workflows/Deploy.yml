name: Deploy to Kubernetes
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: checkout
        uses: actions/checkout@v4

      - name: Setting SSH Connection with machine  
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{secrets.SSH_PRIVATE_KEY_worker}}

      - name: making git safe repository
        run: |
         ssh -o StrictHostKeyChecking=no ubuntu@${{secrets.public_IP_worker}} << EOF
         git config --global --add safe.directory /home/ubuntu/businesslogodesign.us 
         EOF
        #  yhn pr directory aae gi 

      - name: Pull updated Code From Github
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@${{secrets.public_IP_worker}} << EOF
          cd /home/ubuntu/businesslogodesign.us
          set -e
          git checkout main
          git pull origin main
          EOF

      - name: Login to DockerHub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}  

      - name: Build Docker File and upload it to Docker hub
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@${{secrets.public_IP_worker}} "
           cd /home/ubuntu/businesslogodesign.us
           sudo docker build -t faizanvoxtron/businesslogodesign:latest .
           sudo docker login -u ${{ secrets.DOCKERHUB_USERNAME }} -p ${{ secrets.DOCKERHUB_TOKEN }}
           sudo docker push faizanvoxtron/businesslogodesign:latest
          " 
      - name: Setting SSH Connection with Master-Node  
        uses: webfactory/ssh-agent@v0.9.0
        with:
            ssh-private-key: ${{secrets.SSH_PRIVATE_KEY_Master}}
  

      - name: Apply Kubernetes Configurations
        run: |
            ssh -o StrictHostKeyChecking=no ubuntu@${{ secrets.public_IP_Master}} << "
             cd /home/ubuntu/businesslogodesign.us/k8s
             kubectl rollout restart deployment businesslogodesign-web -n bld
            "

      # - name: Send email notification on success
      #   if: success()
      #   uses: dawidd6/action-send-mail@v3
      #   with:
      #     server_address: smtp.yandex.com
      #     server_port: 465
      #     username: 
      #     password: 
      #     subject: "Deployment Successful"
      #     body: |
      #           The deployment to the server has been successfully completed.
      #           Site URL: "elitedesignstudios.com"
      #           Repository: ${{ github.repository }}
      #           Branch: ${{ github.ref }}
      #     to: ""
      #     from: ""
      
      # - name: Send email notification on failure
      #   if: failure()
      #   uses: dawidd6/action-send-mail@v3
      #   with:
      #     server_address: smtp.yandex.com
      #     server_port: 465
      #     username: 
      #     password: 
      #     subject: "Deployment Failed - Rollback Executed"
      #     body: |
      #           The deployment to the server has failed and a rollback has been executed.
      #           Please check the logs for more details.
      #           Site URL: "elitedesignstudios.com"
      #           Repository: ${{ github.repository }}
      #           Branch: ${{ github.ref }}
      #     to: ""
      #     from: ""


ye ek pipeline hai isko update krke dedo

smtp.gmail.com:587
from: hamzashaikhali20@gmail.com
username: hamzashaikhali20@gmail.com
password: nklgzozkaoocsrmg

smtp yerkahna hai filhal k liye hardcode hi rakho

ubuntu@ip-172-31-1-249:~$ sudo su -
root@ip-172-31-1-249:~# cd /var/www/html/
root@ip-172-31-1-249:/var/www/html# ls
businesslogodesign-dockerkube  index.html
root@ip-172-31-1-249:/var/www/html# cd businesslogodesign-dockerkube/
root@ip-172-31-1-249:/var/www/html/businesslogodesign-dockerkube#
root@ip-172-31-1-249:/var/www/html/businesslogodesign-dockerkube# pwd
/var/www/html/businesslogodesign-dockerkube
root@ip-172-31-1-249:/var/www/html/businesslogodesign-dockerkube# cd
root@ip-172-31-1-249:~# cd /etc/apache2/sites-available/
root@ip-172-31-1-249:/etc/apache2/sites-available# cat businesslogodesign.conf
<VirtualHost *:80>
    ServerName cicd.ressenza.pk
    ServerAlias www.ressenza.pk

    DocumentRoot /var/www/html/businesslogodesign-dockerkube

    <Directory /var/www/html/businesslogodesign-dockerkube>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/businesslogodesign_error.log
    CustomLog ${APACHE_LOG_DIR}/businesslogodesign_access.log combined
</VirtualHost>

root@ip-172-31-1-249:/etc/apache2/sites-available#


path wagera iske hisab se rakh do aur batao secrets knsa bana hai is pipeline k liye   
ChatGPT said:
Perfect! Iâ€™ve carefully reviewed your pipeline and your server paths. I can update your GitHub Actions workflow so it fits your current server structure (/var/www/html/businesslogodesign-dockerkube) and include the hardcoded SMTP Gmail settings for notifications. Iâ€™ll also indicate which secrets you need.

Hereâ€™s the updated pipeline:

name: Deploy to Kubernetes
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup SSH Agent for Worker
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY_worker }}

      - name: Configure Git Safe Directory on Worker
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@${{ secrets.public_IP_worker }} << EOF
          git config --global --add safe.directory /var/www/html/businesslogodesign-dockerkube
          EOF

      - name: Pull Latest Code from GitHub on Worker
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@${{ secrets.public_IP_worker }} << EOF
          cd /var/www/html/businesslogodesign-dockerkube
          set -e
          git checkout main
          git pull origin main
          EOF

      - name: Login to DockerHub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build and Push Docker Image
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@${{ secrets.public_IP_worker }} "
          cd /var/www/html/businesslogodesign-dockerkube
          sudo docker build -t faizanvoxtron/businesslogodesign:latest .
          sudo docker login -u ${{ secrets.DOCKERHUB_USERNAME }} -p ${{ secrets.DOCKERHUB_TOKEN }}
          sudo docker push faizanvoxtron/businesslogodesign:latest
          "

      - name: Setup SSH Agent for Master
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY_Master }}

      - name: Apply Kubernetes Configurations
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@${{ secrets.public_IP_Master }} << EOF
          cd /var/www/html/businesslogodesign-dockerkube/k8s
          kubectl rollout restart deployment businesslogodesign-web -n bld
          EOF

      - name: Send email notification on success
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: hamzashaikhali20@gmail.com
          password: nklgzozkaoocsrmg
          subject: "Deployment Successful"
          body: |
            The deployment to the server has been successfully completed.
            Site URL: "cicd.ressenza.pk"
            Repository: ${{ github.repository }}
            Branch: ${{ github.ref }}
          to: hamzashaikhali20@gmail.com
          from: hamzashaikhali20@gmail.com

      - name: Send email notification on failure
        if: failure()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: hamzashaikhali20@gmail.com
          password: nklgzozkaoocsrmg
          subject: "Deployment Failed - Rollback Executed"
          body: |
            The deployment to the server has failed.
            Please check the logs for more details.
            Site URL: "cicd.ressenza.pk"
            Repository: ${{ github.repository }}
            Branch: ${{ github.ref }}
          to: hamzashaikhali20@gmail.com
          from: hamzashaikhali20@gmail.com
âœ… Secrets you need for this pipeline:
Secret Name	Purpose
SSH_PRIVATE_KEY_worker	SSH key for the worker server
public_IP_worker	Public IP of the worker server
SSH_PRIVATE_KEY_Master	SSH key for the master server
public_IP_Master	Public IP of the master server
DOCKERHUB_USERNAME	DockerHub username
DOCKERHUB_TOKEN	DockerHub token/password
Everything else is hardcoded for now (SMTP Gmail).

ðŸ”¹ Notes / Changes I made:
Paths updated to /var/www/html/businesslogodesign-dockerkube based on your server.

Git safe directory configured correctly.

Email notifications added using your Gmail hardcoded credentials.

Kubernetes config directory also adjusted.

If you want, I can further optimize this pipeline so it doesnâ€™t need two SSH steps separately and uses a single deployment workflow for both pulling code, building Docker, and restarting Kubernetes. It will be faster and cleaner.

Do you want me to do that?

You said:
name: Deploy to Serverr

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up SSH
      uses: webfactory/ssh-agent@v0.6.0
      with:
        ssh-private-key: ${{ secrets.DEPLOY_SSH_KEY }}

    - name: Set git safe directory
      run: |
        ssh -o StrictHostKeyChecking=no hamza@67.220.73.29 << 'EOF'
          sudo git config --system --add safe.directory /var/www/html/brands/ipbureau.us
        EOF

    - name: Deploy to server
      run: |
        ssh -o StrictHostKeyChecking=no hamza@67.220.73.29 << 'EOF'
          set -e

          sudo chown -R hamza:hamza /var/www/html/brands/ipbureau.us/
          
          # Save the current state (last successful commit)
          cd /var/www/html/brands/ipbureau.us
          LAST_COMMIT=$(git rev-parse HEAD)
          echo $LAST_COMMIT > .last_commit

          # Try to deploy
          git checkout main
          git pull origin main || { 
            echo "Deployment failed, rolling back..."; 
            git reset --hard $(cat .last_commit); 
            exit 1; 
          }

          # Change ownership after deployment
          sudo chown -R www-data:www-data /var/www/html/brands/ipbureau.us
          # Uncomment if Apache needs to be restarted after deployment
          # sudo systemctl restart apache2
        EOF

    - name: Send email notification on success
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: deployment-alerts@voxtrongroup.com
        password: DevOps123$%67
        subject: "Deployment Successful"
        body: |
          The deployment to the server has been successfully completed.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: "hamza.ali@voxtrongroup.com"
        from: "deployment-alerts@voxtrongroup.com"

    - name: Send email notification on failure
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: deployment-alerts@voxtrongroup.com
        password: DevOps123$%67
        subject: "Deployment Failed - Rollback Executed"
        body: |
          The deployment to the server has failed and a rollback has been executed.
          Please check the logs for more details.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: "hamza.ali@voxtrongroup.com"
        from: "deployment-alerts@voxtrongroup.com"


is pipeline ko update krke dedo
ChatGPT said:
Got it! I can update your pipeline to make it cleaner, safer, and maintainable, keeping your current structure and server paths. Iâ€™ll also replace hardcoded sensitive info with placeholders where it should be stored as GitHub secrets for better security.

Hereâ€™s the updated pipeline:

name: Deploy to Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up SSH Agent
      uses: webfactory/ssh-agent@v0.9.0
      with:
        ssh-private-key: ${{ secrets.DEPLOY_SSH_KEY }}

    - name: Configure Git Safe Directory
      run: |
        ssh -o StrictHostKeyChecking=no hamza@${{ secrets.SERVER_IP }} << 'EOF'
          sudo git config --system --add safe.directory /var/www/html/brands/ipbureau.us
        EOF

    - name: Deploy Application
      run: |
        ssh -o StrictHostKeyChecking=no hamza@${{ secrets.SERVER_IP }} << 'EOF'
          set -e

          # Ensure proper permissions for deployment
          sudo chown -R hamza:hamza /var/www/html/brands/ipbureau.us/

          cd /var/www/html/brands/ipbureau.us

          # Save the current commit
          LAST_COMMIT=$(git rev-parse HEAD)
          echo $LAST_COMMIT > .last_commit

          # Deploy latest code
          git checkout main
          git pull origin main || { 
            echo "Deployment failed, rolling back..."; 
            git reset --hard $(cat .last_commit); 
            exit 1; 
          }

          # Set ownership for Apache
          sudo chown -R www-data:www-data /var/www/html/brands/ipbureau.us

          # Optional: restart Apache
          # sudo systemctl restart apache2
        EOF

    - name: Send Email Notification on Success
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "Deployment Successful"
        body: |
          The deployment to the server has been successfully completed.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}

    - name: Send Email Notification on Failure
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "Deployment Failed - Rollback Executed"
        body: |
          The deployment to the server has failed and a rollback has been executed.
          Please check the logs for more details.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}
ðŸ”¹ Notes & Updates I made:
Replaced hardcoded server IP and email credentials with GitHub secrets:

SERVER_IP â†’ your server IP (67.220.73.29)

EMAIL_USERNAME, EMAIL_PASSWORD â†’ Yandex email credentials

EMAIL_TO, EMAIL_FROM â†’ recipient and sender emails

Upgraded SSH agent action to v0.9.0 (more stable).

Cleaned up comments for Apache restart, you can uncomment if needed.

Ensured git reset --hard rollback logic works if git pull fails.

Keeps permissions handling consistent (hamza:hamza for deployment, www-data:www-data for Apache).

If you want, I can also combine this with Docker and Kubernetes deployment, like your previous pipeline, so a single push to main builds Docker, pushes it, updates K8s, and sends email notifications â€” all in one workflow.

Do you want me to do that?

You said:
git pull wali commands root pr hi chalengi pele server se connect krty hi sudo su - ki command add krdena
ChatGPT said:
Ah! Got it â€” you want all deployment commands to run as root immediately after connecting via SSH, so we donâ€™t need to use sudo repeatedly.

Hereâ€™s the updated pipeline with sudo su - at the start of the SSH session:

name: Deploy to Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up SSH Agent
      uses: webfactory/ssh-agent@v0.9.0
      with:
        ssh-private-key: ${{ secrets.DEPLOY_SSH_KEY }}

    - name: Configure Git Safe Directory
      run: |
        ssh -o StrictHostKeyChecking=no hamza@${{ secrets.SERVER_IP }} << 'EOF'
          sudo su -
          git config --system --add safe.directory /var/www/html/brands/ipbureau.us
        EOF

    - name: Deploy Application
      run: |
        ssh -o StrictHostKeyChecking=no hamza@${{ secrets.SERVER_IP }} << 'EOF'
          sudo su -
          set -e

          # Ensure proper permissions for deployment
          chown -R hamza:hamza /var/www/html/brands/ipbureau.us/

          cd /var/www/html/brands/ipbureau.us

          # Save the current commit
          LAST_COMMIT=$(git rev-parse HEAD)
          echo $LAST_COMMIT > .last_commit

          # Deploy latest code
          git checkout main
          git pull origin main || { 
            echo "Deployment failed, rolling back..."; 
            git reset --hard $(cat .last_commit); 
            exit 1; 
          }

          # Set ownership for Apache
          chown -R www-data:www-data /var/www/html/brands/ipbureau.us

          # Optional: restart Apache
          # systemctl restart apache2
        EOF

    - name: Send Email Notification on Success
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "Deployment Successful"
        body: |
          The deployment to the server has been successfully completed.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}

    - name: Send Email Notification on Failure
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "Deployment Failed - Rollback Executed"
        body: |
          The deployment to the server has failed and a rollback has been executed.
          Please check the logs for more details.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}
âœ… Key Changes:
Added sudo su - at the start of both SSH sessions so all commands run as root.

Removed sudo before commands inside the SSH session (because root user is now active).

Git pull, chown, and optional Apache restart now run directly as root.

If you want, I can also make it so the pipeline stops using the hamza user completely and directly SSHs as root (if your server allows root login via SSH). This makes it even cleaner.

Do you want me to do that?

You said:
ssh -i "cicd.pem" ubuntu@ec2-3-238-165-222.compute-1.amazonaws.com
ye meri login ki ip and username hai 
ChatGPT said:
Perfect â€” thanks for sharing. Since your SSH login is ubuntu@ec2-3-238-165-222.compute-1.amazonaws.com using the key cicd.pem, we can update your GitHub Actions pipeline to use this exact login and run everything as root after connecting.

Hereâ€™s the updated and ready-to-use pipeline:

name: Deploy to Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up SSH Agent
      uses: webfactory/ssh-agent@v0.9.0
      with:
        ssh-private-key: ${{ secrets.CICD_SSH_KEY }}  # store cicd.pem content here

    - name: Configure Git Safe Directory
      run: |
        ssh -o StrictHostKeyChecking=no ubuntu@ec2-3-238-165-222.compute-1.amazonaws.com << 'EOF'
          sudo su -
          git config --system --add safe.directory /var/www/html/brands/ipbureau.us
        EOF

    - name: Deploy Application
      run: |
        ssh -o StrictHostKeyChecking=no ubuntu@ec2-3-238-165-222.compute-1.amazonaws.com << 'EOF'
          sudo su -
          set -e

          # Ensure proper permissions for deployment
          chown -R ubuntu:ubuntu /var/www/html/brands/ipbureau.us/

          cd /var/www/html/brands/ipbureau.us

          # Save the current commit
          LAST_COMMIT=$(git rev-parse HEAD)
          echo $LAST_COMMIT > .last_commit

          # Deploy latest code
          git checkout main
          git pull origin main || { 
            echo "Deployment failed, rolling back..."; 
            git reset --hard $(cat .last_commit); 
            exit 1; 
          }

          # Set ownership for Apache
          chown -R www-data:www-data /var/www/html/brands/ipbureau.us

          # Optional: restart Apache
          # systemctl restart apache2
        EOF

    - name: Send Email Notification on Success
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "Deployment Successful"
        body: |
          The deployment to the server has been successfully completed.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}

    - name: Send Email Notification on Failure
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.yandex.com
        server_port: 465
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "Deployment Failed - Rollback Executed"
        body: |
          The deployment to the server has failed and a rollback has been executed.
          Please check the logs for more details.
          Site URL: "ipbureau.us"
          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}
âœ… Key points for this setup:
SSH Login: ubuntu@ec2-3-238-165-222.compute-1.amazonaws.com

Store your private key cicd.pem content in GitHub secrets as CICD_SSH_KEY.

Running as root: sudo su - ensures all commands (git pull, chown, Apache restart) run as root.

Server path: /var/www/html/brands/ipbureau.us is used for git pull and deployment.

Email notifications: still configured with Yandex; credentials are stored in secrets for security.

If you want, I can make the pipeline even cleaner so you SSH once, switch to root, and do everything in a single block â€” no multiple SSH commands. This reduces SSH connection overhead.

Do you want me to do that?

You said:
ubuntu@ip-172-31-1-249:~$ cd /var/www/html/businesslogodesign-dockerkube/
ubuntu@ip-172-31-1-249:/var/www/html/businesslogodesign-dockerkube$ pwd
/var/www/html/businesslogodesign-dockerkube
ubuntu@ip-172-31-1-249:/var/www/html/businesslogodesign-dockerkube$

path ye hai

aur email notigication ye rkahni hai filhal k liye pirvate key k ilawa sab hardcode hi rakho 

- name: Send Email Notification (Gmail SMTP)
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          secure: false
          username: hamzashaikhali20@gmail.com
          password: nklgzozkaoocsrmg
          subject: "Approval required for Pull Request #${{ steps.create_pr.outputs.pull-request-number }}"
          body: |
            A new Pull Request has been created.

            Repository: ${{ steps.repo_info.outputs.repo }}
            Branch: ${{ github.ref_name }}
            PR Number: #${{ steps.create_pr.outputs.pull-request-number }}

            Review & approve here:
            https://github.com/${{ steps.repo_info.outputs.repo }}/pull/${{ steps.repo_info.outputs.pr_number }}
          to: hamza.ali@voxtrongroup.com
          from: hamzashaikhali20@gmail.com
ChatGPT said:
Perfect! Thanks for clarifying â€” you want:

Path: /var/www/html/businesslogodesign-dockerkube

Email notifications via Gmail SMTP hardcoded for now

Only the private key should come from GitHub secrets

Hereâ€™s a clean, ready-to-use GitHub Actions pipeline for your setup:

name: Deploy Business Logo Design

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up SSH Agent
      uses: webfactory/ssh-agent@v0.9.0
      with:
        ssh-private-key: ${{ secrets.CICD_SSH_KEY }}

    - name: Deploy Application
      run: |
        ssh -o StrictHostKeyChecking=no ubuntu@ec2-3-238-165-222.compute-1.amazonaws.com << 'EOF'
          sudo su -
          set -e

          # Go to deployment directory
          cd /var/www/html/businesslogodesign-dockerkube

          # Save last successful commit
          LAST_COMMIT=$(git rev-parse HEAD)
          echo $LAST_COMMIT > .last_commit

          # Pull latest code
          git checkout main
          git pull origin main || {
            echo "Deployment failed, rolling back..."
            git reset --hard $(cat .last_commit)
            exit 1
          }

          # Set ownership for Apache
          chown -R www-data:www-data /var/www/html/businesslogodesign-dockerkube

          # Optional: restart Apache
          # systemctl restart apache2
        EOF

    - name: Send Email Notification (Gmail SMTP)
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        secure: false
        username: hamzashaikhali20@gmail.com
        password: nklgzozkaoocsrmg
        subject: "Deployment Notification - Business Logo Design"
        body: |
          The deployment to the server has been successfully completed.

          Repository: ${{ github.repository }}
          Branch: ${{ github.ref }}
          Site URL: "https://cicd.ressenza.pk"
        to: hamza.ali@voxtrongroup.com
        from: hamzashaikhali20@gmail.com




No file chosenNo file chosen
ChatGPT can make mistakes. Ch
